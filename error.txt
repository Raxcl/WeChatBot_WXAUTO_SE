2025-07-10 18:50:49,100 - DEBUG - load_ssl_context verify=True cert=None trust_env=True http2=False
2025-07-10 18:50:49,105 - DEBUG - load_verify_locations cafile='C:\\Users\\raxcl\\AppData\\Local\\Temp\\_MEI100482\\certifi\\cacert.pem'
2025-07-10 18:50:49,613 - DEBUG - load_ssl_context verify=True cert=None trust_env=True http2=False
2025-07-10 18:50:49,615 - DEBUG - load_verify_locations cafile='C:\\Users\\raxcl\\AppData\\Local\\Temp\\_MEI100482\\certifi\\cacert.pem'
2025-07-10 18:50:50,181 - DEBUG - load_ssl_context verify=True cert=None trust_env=True http2=False
2025-07-10 18:50:50,182 - DEBUG - load_verify_locations cafile='C:\\Users\\raxcl\\AppData\\Local\\Temp\\_MEI100482\\certifi\\cacert.pem'
2025-07-10 18:50:50,803 - INFO - 进行启动前检查...
2025-07-10 18:50:50,806 - INFO - 正在初始化AI平台路由器...
2025-07-10 18:50:50,809 - DEBUG - Mapped user '测试群1' to role '李白' on platform 'coze'
2025-07-10 18:50:50,810 - DEBUG - Mapped user '测试群2' to role '角色2' on platform 'llm_direct'
2025-07-10 18:50:50,810 - DEBUG - Mapped user 'raxcl' to role '角色2' on platform 'llm_direct'
2025-07-10 18:50:50,811 - INFO - Successfully parsed 3 users from LISTEN_LIST
2025-07-10 18:50:50,811 - DEBUG - Mapped user '测试群1' to role '李白' on platform 'coze'
2025-07-10 18:50:50,811 - DEBUG - Mapped user '测试群2' to role '角色2' on platform 'llm_direct'
2025-07-10 18:50:50,811 - DEBUG - Mapped user 'raxcl' to role '角色2' on platform 'llm_direct'
2025-07-10 18:50:50,811 - INFO - Successfully parsed 3 users from LISTEN_LIST
2025-07-10 18:50:51,595 - INFO - LLMDirectPlatform 初始化完成
2025-07-10 18:50:51,596 - INFO - LLM Direct platform initialized with model: deepseek-ai/DeepSeek-R1-0528-Qwen3-8B
2025-07-10 18:50:51,596 - INFO - 成功初始化 llm_direct 平台
2025-07-10 18:50:51,596 - INFO - CozePlatform 初始化完成
2025-07-10 18:50:51,597 - INFO - 使用 JWT OAuth 方式获取 Token（支持自动刷新）
2025-07-10 18:50:51,597 - INFO - config.py中的token已过期或即将过期（剩余时间少于30分钟），将获取新token
2025-07-10 18:50:51,598 - INFO - 正在获取新的JWT OAuth token...
2025-07-10 18:50:51,716 - DEBUG - load_ssl_context verify=True cert=None trust_env=True http2=False
2025-07-10 18:50:51,717 - DEBUG - load_verify_locations cafile='C:\\Users\\raxcl\\AppData\\Local\\Temp\\_MEI100482\\certifi\\cacert.pem'
2025-07-10 18:50:52,191 - DEBUG - load_ssl_context verify=True cert=None trust_env=True http2=False
2025-07-10 18:50:52,192 - DEBUG - load_verify_locations cafile='C:\\Users\\raxcl\\AppData\\Local\\Temp\\_MEI100482\\certifi\\cacert.pem'
2025-07-10 18:50:52,661 - DEBUG - load_ssl_context verify=True cert=None trust_env=True http2=False
2025-07-10 18:50:52,662 - DEBUG - load_verify_locations cafile='C:\\Users\\raxcl\\AppData\\Local\\Temp\\_MEI100482\\certifi\\cacert.pem'
2025-07-10 18:50:53,134 - DEBUG - connect_tcp.started host='127.0.0.1' port=7890 local_address=None timeout=5.0 socket_options=None
2025-07-10 18:50:53,135 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001E8AAEB2EA0>
2025-07-10 18:50:53,136 - DEBUG - send_request_headers.started request=<Request [b'CONNECT']>
2025-07-10 18:50:53,137 - DEBUG - send_request_headers.complete
2025-07-10 18:50:53,137 - DEBUG - send_request_body.started request=<Request [b'CONNECT']>
2025-07-10 18:50:53,137 - DEBUG - send_request_body.complete
2025-07-10 18:50:53,138 - DEBUG - receive_response_headers.started request=<Request [b'CONNECT']>
2025-07-10 18:50:53,138 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'Connection established', [])
2025-07-10 18:50:53,139 - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000001E8AAED4AD0> server_hostname='api.coze.cn' timeout=5.0
2025-07-10 18:50:53,398 - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001E8AAE4B260>
2025-07-10 18:50:53,400 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-07-10 18:50:53,402 - DEBUG - send_request_headers.complete
2025-07-10 18:50:53,403 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-07-10 18:50:53,404 - DEBUG - send_request_body.complete
2025-07-10 18:50:53,404 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-07-10 18:50:53,521 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Server', b'volc-dcdn'), (b'Content-Type', b'application/json'), (b'Content-Length', b'134'), (b'Connection', b'keep-alive'), (b'Date', b'Thu, 10 Jul 2025 10:50:53 GMT'), (b'X-Tt-Logid', b'20250710185053BD1EE6C26E09BC85ADD7'), (b'Server-Timing', b'inner; dur=30, cdn-cache;desc=MISS, origin;dur=47, edge;dur=0, tt_agw; dur=26'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains'), (b'x-tt-trace-host', b'014c14acc83e96e18f626aea95757797ee556399b72e32f65b928a92344cf116098cedd31dff5cd49c38f694885d0ad1e127698c25f903b085cbff9a3017472e2b94cf0745eb33f90cd7c530c05d9f1bacb850d71c5d25fa4805f0b620b4524a09'), (b'x-tt-trace-tag', b'id=5'), (b'x-tt-trace-id', b'00-f3f5ae7b0301006d64cfb31180cc0000-f3f5ae7b0301006d-01'), (b'X-TT-TIMESTAMP', b'1752144653.579'), (b'via', b'n101-026-038-213.hdcu-container.Creative'), (b'x-request-ip', b'221.4.209.203'), (b'x-dsa-trace-id', b'17521446530a3f7a2e02836e5d9077d2fc2b753cf9'), (b'X-Dsa-Origin-Status', b'200')])
2025-07-10 18:50:53,523 - INFO - HTTP Request: POST https://api.coze.cn/api/permission/oauth2/token "HTTP/1.1 200 OK"
2025-07-10 18:50:53,524 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-07-10 18:50:53,525 - DEBUG - receive_response_body.complete
2025-07-10 18:50:53,525 - DEBUG - response_closed.started
2025-07-10 18:50:53,526 - DEBUG - response_closed.complete
2025-07-10 18:50:53,528 - INFO - JWT OAuth token 获取成功，oauth_token: access_token='czs_lqARslqwcXe1Gl4dHRbgeQO8rJ6bAwLwG1FLnbYalW1875lgd9fKjzK0aleLi2ID1' expires_in=1752231052 refresh_token='' token_type='Bearer'
2025-07-10 18:50:53,529 - INFO - 过期时间: 2025-07-11 18:50:52
2025-07-10 18:50:53,529 - INFO - Token实际剩余有效期: 24.0 小时
2025-07-10 18:50:53,530 - WARNING - 回写token到config.py失败: [Errno 2] No such file or directory: 'C:\\Users\\raxcl\\AppData\\Local\\Temp\\_MEI100482\\config.py'
2025-07-10 18:50:53,534 - INFO - Coze 平台初始化成功，工作流 ID: 7522684897447526438
2025-07-10 18:50:53,536 - INFO - 成功初始化 coze 平台
2025-07-10 18:50:53,536 - INFO - 平台路由器初始化完成，共 2 个平台
2025-07-10 18:50:53,537 - INFO - 用户映射包含 3 个用户
2025-07-10 18:50:53,537 - INFO - Platform router created successfully
2025-07-10 18:50:53,537 - INFO - Global platform router initialized
2025-07-10 18:50:53,537 - INFO - AI平台路由初始化成功，支持 3 个用户
2025-07-10 18:50:53,538 - INFO - 正在加载聊天上下文...
2025-07-10 18:50:53,540 - INFO - 成功从 chat_contexts.json 加载 1 个用户的聊天上下文。
2025-07-10 18:50:53,541 - INFO - 提醒功能已启用。
2025-07-10 18:50:53,541 - INFO - 成功从 recurring_reminders.json 加载 0 条有效提醒。
2025-07-10 18:50:53,542 - INFO - 群聊总结功能已启用。
2025-07-10 18:50:53,542 - INFO - 正在初始化数据库连接...
2025-07-10 18:50:54,189 - WARNING - 日志发送连接错误 (尝试 1/3): HTTPConnectionPool(host='localhost', port=5000): Max retries exceeded with url: /api/log (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x000001E8A6EFED50>: Failed to establish a new connection: [WinError 10061] 由于目标计算机积极拒绝，无法连接。'))
2025-07-10 18:50:55,750 - ERROR - 数据库连接测试失败: (pymysql.err.OperationalError) (2003, "Can't connect to MySQL server on '43.139.211.77' ([WinError 10061] 由于目标计算机积极拒绝，无法连接。)")
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-07-10 18:50:55,753 - INFO - 数据库功能未启用或连接失败，将使用文件存储
2025-07-10 18:50:55,753 - INFO - 初始化微信接口和清理临时文件...
2025-07-10 18:50:55,754 - INFO - 目录 wxautox文件下载 不存在，无需删除
2025-07-10 18:50:55,768 - ERROR - 无法初始化微信接口，请确保您安装的是微信3.9版本，并且已经登录！详细错误: 未找到微信窗口：None
2025-07-10 18:50:55,769 - ERROR - 微信3.9版本下载地址：https://dldir1v6.qq.com/weixin/Windows/WeChatSetup.exe 
2025-07-10 18:50:55,770 - CRITICAL - 主程序发生严重错误: name 'exit' is not defined
Traceback (most recent call last):
  File "bot.py", line 3850, in main
    wx = WeChat()
         ^^^^^^^^
  File "C:\Users\raxcl\AppData\Local\Temp\_MEI100482\wxautox_wechatbot\wx.py", line 360, in __init__
  File "C:\Users\raxcl\AppData\Local\Temp\_MEI100482\wxautox_wechatbot\ui.py", line 1852, in __init__
Exception: 未找到微信窗口：None

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "bot.py", line 3857, in main
    exit(1)
    ^^^^
NameError: name 'exit' is not defined
2025-07-10 18:50:55,780 - INFO - 程序准备退出，执行清理操作...
2025-07-10 18:50:55,781 - INFO - 没有活动的短期一次性提醒定时器需要取消。
2025-07-10 18:50:55,781 - INFO - 正在关闭异步HTTP日志处理器...
2025-07-10 18:50:55,782 - INFO - 关闭日志处理器，还有 74 条日志待处理
2025-07-10 18:50:58,746 - WARNING - 日志发送连接错误 (尝试 2/3): HTTPConnectionPool(host='localhost', port=5000): Max retries exceeded with url: /api/log (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x000001E8ABFADE20>: Failed to establish a new connection: [WinError 10061] 由于目标计算机积极拒绝，无法连接。'))
2025-07-10 18:51:03,536 - WARNING - 日志发送连接错误 (尝试 3/3): HTTPConnectionPool(host='localhost', port=5000): Max retries exceeded with url: /api/log (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x000001E8ABFAF1A0>: Failed to establish a new connection: [WinError 10061] 由于目标计算机积极拒绝，无法连接。'))
2025-07-10 18:51:03,539 - ERROR - 发送日志批次失败，已达到最大重试次数 (3)，丢弃 4 条日志 (连续失败: 1, 持续时间: 14.4秒)
2025-07-10 18:51:07,595 - WARNING - 日志发送连接错误 (尝试 1/3): HTTPConnectionPool(host='localhost', port=5000): Max retries exceeded with url: /api/log (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x000001E8ABFAF980>: Failed to establish a new connection: [WinError 10061] 由于目标计算机积极拒绝，无法连接。'))
2025-07-10 18:51:12,160 - WARNING - 日志发送连接错误 (尝试 2/3): HTTPConnectionPool(host='localhost', port=5000): Max retries exceeded with url: /api/log (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x000001E8AA89ED50>: Failed to establish a new connection: [WinError 10061] 由于目标计算机积极拒绝，无法连接。'))
2025-07-10 18:51:16,983 - WARNING - 日志发送连接错误 (尝试 3/3): HTTPConnectionPool(host='localhost', port=5000): Max retries exceeded with url: /api/log (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x000001E8ABFAF200>: Failed to establish a new connection: [WinError 10061] 由于目标计算机积极拒绝，无法连接。'))
2025-07-10 18:51:16,985 - ERROR - 发送日志批次失败，已达到最大重试次数 (3)，丢弃 1 条日志 (连续失败: 2, 持续时间: 27.9秒)
2025-07-10 18:51:21,044 - WARNING - 日志发送连接错误 (尝试 1/3): HTTPConnectionPool(host='localhost', port=5000): Max retries exceeded with url: /api/log (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x000001E8ABFADEB0>: Failed to establish a new connection: [WinError 10061] 由于目标计算机积极拒绝，无法连接。'))
2025-07-10 18:51:25,600 - WARNING - 日志发送连接错误 (尝试 2/3): HTTPConnectionPool(host='localhost', port=5000): Max retries exceeded with url: /api/log (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x000001E8AC048200>: Failed to establish a new connection: [WinError 10061] 由于目标计算机积极拒绝，无法连接。'))
2025-07-10 18:51:30,406 - WARNING - 日志发送连接错误 (尝试 3/3): HTTPConnectionPool(host='localhost', port=5000): Max retries exceeded with url: /api/log (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x000001E8AC048AD0>: Failed to establish a new connection: [WinError 10061] 由于目标计算机积极拒绝，无法连接。'))
2025-07-10 18:51:30,409 - ERROR - 发送日志批次失败，已达到最大重试次数 (3)，丢弃 1 条日志 (连续失败: 3, 持续时间: 41.3秒)
2025-07-10 18:51:30,411 - INFO - 日志处理线程已正常退出
2025-07-10 18:51:30,412 - INFO - 异步HTTP日志处理器已关闭。
2025-07-10 18:51:30,412 - INFO - 执行最终临时文件清理...
2025-07-10 18:51:30,413 - INFO - 目录 wxautox文件下载 不存在，无需删除
2025-07-10 18:51:30,414 - INFO - 正在关闭数据库连接...
2025-07-10 18:51:30,414 - INFO - 数据库连接已关闭
2025-07-10 18:51:30,415 - INFO - 程序退出。
2025-07-10 18:51:30,419 - INFO - 关闭日志处理器，还有 91 条日志待处理
2025-07-10 18:52:00,484 - INFO - 日志处理线程已正常退出
